<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Static Web Notepad</title>
  <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.4.1/dist/html-docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.3/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

  <style>
    :root{--bg:#f7f8fb;--card:#fff;--muted:#666;--sidebar:#f8fafc;--accent:#0b66ff;--active-bg:#e9ecef}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:#111}

    /* layout */
    .app{display:grid;grid-template-columns:300px 1fr;grid-template-rows:1fr auto;height:100vh;transition:grid-template-columns .25s ease}

    /* 1. 변경: 사이드바 숨김 상태일 때 그리드 레이아웃 변경 */
    .app.sidebar-hidden{grid-template-columns:0 1fr}

    /* sidebar */
    nav{background:var(--sidebar);border-right:1px solid #e6e9ef;padding:12px;overflow:auto;transition:transform .25s ease,width .25s}
    .app.sidebar-hidden nav{transform:translateX(-100%);padding:12px 0;border-right:none}

    header{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    header h2{margin:0;font-size:16px}

    .controls{display:flex;gap:6px;flex-wrap:wrap}
    button,select,input[type=text]{background:#fff;border:1px solid #ddd;padding:6px 8px;border-radius:6px;cursor:pointer}
    button.small{padding:6px}
    .list{margin-top:8px}
    .section-title{font-size:12px;color:var(--muted);margin:10px 0 6px}

    .folder, .file-item{padding:8px;border-radius:6px;margin-bottom:6px;display:flex;align-items:center;justify-content:space-between}
    .folder{background:linear-gradient(90deg,#fdfdfd,#fbfcff);border:1px solid #eee}
    .file-item{background:#fff;border:1px solid #f0f3f7}
    .file-item.draggable{cursor:grab}
    .file-item .meta{flex:1;overflow:hidden}
    .file-item .meta .name{font-weight:600;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}
    .file-item .meta .sub{font-size:12px;color:var(--muted)}
    .file-item .actions{display:flex;gap:6px;margin-left:8px}

    /* 2. 변경: 활성 항목 스타일 추가 */
    .folder.active-file, .file-item.active-file { background-color: var(--active-bg); }

    /* editor area */
    main{display:flex;flex-direction:column;gap:8px;padding:12px;overflow:hidden} /* overflow hidden 추가 */
    .toolbar{display:flex;gap:6px;align-items:center}
    .toolbar .group{display:flex;gap:6px;align-items:center;background:var(--card);padding:6px;border-radius:8px;border:1px solid #e9edf3}
    #editor{flex:1;background:var(--card);border:1px solid #e6e9ef;padding:16px;border-radius:8px;overflow:auto}
    #editor[contenteditable="true"]:focus{outline:3px solid rgba(100,150,250,0.12)}

    .top-right-actions{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn-action{padding:6px 8px;border-radius:6px}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:200}
    .modal{background:var(--card);padding:16px;border-radius:8px;width:320px;box-shadow:0 6px 32px rgba(0,0,0,0.15)}

    /* 5. 변경: 통계 푸터 스타일 추가 */
    #statsFooter{grid-column: 2 / 3; background:transparent;padding:6px 12px;border-top:1px solid #e9edf3;display:flex;gap:16px;align-items:center;font-size:12px;color:var(--muted); flex-wrap: wrap; }
    #statsFooter span { font-weight: 500; color: #444; }
    body.dark #statsFooter { border-color: #4a4a4a; color: var(--muted); }
    body.dark #statsFooter span { color: #ddd; }


    .github-icon{width:20px;height:20px;vertical-align:middle}
    .drop-target{outline:2px dashed rgba(11,102,255,0.12)}
    .folder-children{margin-left:12px;margin-top:6px}
    :root.dark{--bg:#2b2b2b;--card:#393939;--muted:#bfc4c8;--sidebar:#333437;--accent:#9fb8ff;--active-bg:#4a4a4a}
    body.dark{background:var(--bg);color:#efefef}
    body.dark nav{background:var(--sidebar);border-color:#4a4a4a}
    body.dark .file-item, body.dark .folder{background:var(--card);border-color:#4a4a4a}
    body.dark button{background:#5a5a5a;color:#eee;border-color:#666}

    #expandHandle{position:fixed;left:8px;top:16px;width:36px;height:36px;border-radius:6px;background:var(--card);border:1px solid #ddd;display:none;align-items:center;justify-content:center;z-index:300;cursor:pointer}
    .app.sidebar-hidden #expandHandle{display:flex}

    @media (max-width:800px){.app{grid-template-columns:1fr;grid-template-rows:auto 1fr auto}nav{order:2;height:220px;overflow:auto}.editor-wrap{order:1} #statsFooter{grid-column: 1 / -1;}}
  </style>
</head>
<body id="bodyRoot">
  <div class="app" id="appRoot">
    <nav id="sidebar">
      <header>
        <h2>Web Notepad</h2>
        <div style="margin-left:auto;display:flex;gap:6px;align-items:center">
          <button class="small" id="toggleSidebarBtn" title="사이드바 숨기기">⬅</button>
          <button class="small" id="btnNewFile">+ 파일</button>
          <button class="small" id="btnNewFolder">+ 폴더</button>
        </div>
      </header>

      <div class="controls">
        <input id="search" type="text" placeholder="검색 (파일명/내용)" style="flex:1">
        <select id="filter"><option value="all">전체</option><option value="star">북마크</option></select>
      </div>

      <div class="list">
        <div class="section-title">폴더</div>
        <div id="folders" ondragover="allowDrop(event)"></div>

        <div class="section-title">파일</div>
        <div id="files" ondragover="allowDrop(event)"></div>
      </div>

      <div style="margin-top:12px">
        <div class="section-title">임포트</div>
        <input id="fileInput" type="file" multiple accept=".txt,.md,.html,.docx,.pdf" />
        <div style="margin-top:6px;font-size:12px;color:var(--muted)">여러 파일 선택 가능 • .txt/.docx/.pdf 지원</div>

        <div class="section-title" style="margin-top:12px">병합 / 관리</div>
        <button id="btnMerge">선택 파일 병합</button>
        <button id="btnDeleteSelected">선택 삭제</button>
      </div>
    </nav>

    <main class="editor-wrap">
      <div class="toolbar">
        <div class="group">
          <button onclick="doCmd('bold')"><b>B</b></button>
          <button onclick="doCmd('italic')"><i>I</i></button>
          <button onclick="doCmd('underline')"><u>U</u></button>
          <button onclick="doCmd('strikeThrough')">S</button>
          <input type="color" id="colorPick" title="색상" onchange="doCmd('foreColor', this.value)">
          <select id="fontSize" onchange="doCmd('fontSize', this.value)"><option value="3">기본</option><option value="4">크게</option><option value="5">더 크게</option></select>
        </div>

        <div class="group">
            <button id="btnSave" class="btn-action">💾 저장</button>
            <button id="btnExport" class="btn-action">내보내기</button>
            <label style="display:inline-flex;align-items:center;gap:6px;font-size:13px"><input type="checkbox" id="autoSave"> 자동저장</label>
        </div>

        <div class="top-right-actions">
          <input id="fileNameInput" type="text" placeholder="파일 이름" style="min-width:200px;padding:6px;border-radius:6px;border:1px solid #ddd;">
          <button id="btnActions" class="btn-action">작업 ▾</button>
          <button id="btnSettings">⚙ 환경설정</button>
        </div>
      </div>

      <div id="editor" contenteditable="true" spellcheck="false"></div>
    </main>

    <div id="expandHandle" title="사이드바 펼치기">➡</div>

    <footer id="statsFooter">
        글자: <span id="statChars">0</span>
        공백제외: <span id="statCharsNoSpace">0</span>
        단어: <span id="statWords">0</span>
        문단: <span id="statParagraphs">0</span>
        용량: <span id="statSize">0 B</span>
    </footer>

  </div>

  <div id="modalRoot" style="display:none"></div>

<script>
// --- 데이터 model (localStorage 기반) ---
const DB_KEY = 'web_notepad_v1';
let db = {folders: {}, files: {}, order: []};
let selectedFiles = new Set();
let currentFileId = null;

function loadDB(){
  const raw = localStorage.getItem(DB_KEY);
  if(raw) try{db = JSON.parse(raw)}catch(e){console.error(e)}
}
function saveDB(){
  localStorage.setItem(DB_KEY, JSON.stringify(db));
}

function uid(prefix='f'){return prefix+Date.now().toString(36)+Math.random().toString(36).slice(2,8)}

// --- initial ---
loadDB();
if(Object.keys(db.files).length===0){
  const id = uid(); db.files[id] = {id,name:'새 문서',content:'',folder:null,star:false,created:Date.now(),updated:Date.now()}; db.order.push(id); saveDB();}

// --- drag helpers ---
let dragId = null; // id of file or folder being dragged
let dragType = null; // 'file' or 'folder'

function allowDrop(e){ e.preventDefault(); }
function onDragStart(ev, id, type){ dragId = id; dragType = type; ev.dataTransfer.setData('text/plain', id); ev.dataTransfer.effectAllowed = 'move'; }
function onFilesDrop(ev){ ev.preventDefault(); const targetId = ev.target.closest('.file-item')?.dataset?.id || null;
  if(dragType === 'file' && dragId){ reorderFile(dragId, targetId); dragId=null; render(); }
}
function onFolderDrop(ev){ ev.preventDefault(); const folderEl = ev.target.closest('.folder'); if(!folderEl || !dragId) return; const folderId = folderEl.dataset.id; if(dragType==='file'){ db.files[dragId].folder = folderId; db.files[dragId].updated = Date.now(); saveDB(); render(); } dragId=null; }
function reorderFile(dragIdLocal, targetId){
  const idx = db.order.indexOf(dragIdLocal); if(idx>-1) db.order.splice(idx,1);
  if(targetId && db.order.indexOf(targetId)!==-1){ const ti = db.order.indexOf(targetId); db.order.splice(ti,0,dragIdLocal); } else { db.order.push(dragIdLocal); }
  saveDB();
}
if(!db.folderOrder) db.folderOrder = Object.keys(db.folders);
function reorderFolder(dragIdLocal, targetId){ const arr = db.folderOrder||[]; const idx = arr.indexOf(dragIdLocal); if(idx>-1) arr.splice(idx,1); if(targetId && arr.indexOf(targetId)!==-1){ const ti = arr.indexOf(targetId); arr.splice(ti,0,dragIdLocal); } else arr.push(dragIdLocal); db.folderOrder = arr; saveDB(); }

// --- render ---
function render(){
  renderFolders();
  renderFiles();
}

function renderFolders(){
  const cont = document.getElementById('folders'); cont.innerHTML='';
  const order = db.folderOrder && db.folderOrder.length?db.folderOrder:Object.keys(db.folders);
  const currentFile = db.files[currentFileId];

  order.forEach(fid=>{ const f = db.folders[fid]; if(!f) return; const el = document.createElement('div'); el.className='folder'; el.draggable = true; el.dataset.id = f.id;
    // 2. 변경: 현재 파일이 이 폴더에 속해있으면 active-file 클래스 추가
    if(currentFile && currentFile.folder === f.id) { el.classList.add('active-file'); }
    el.innerHTML = `<div style="flex:1;display:flex;align-items:center;gap:8px"><button onclick="toggleFolder('${f.id}')">▸</button><div style=\"flex:1;cursor:pointer\" onclick=\"openFolder('${f.id}')\">📁 ${escapeHtml(f.name)}</div></div><div style="display:flex;gap:6px"><button onclick="renameFolder('${f.id}')">✏️</button><button onclick="deleteFolder('${f.id}')">🗑️</button></div>`;
    el.ondragstart = (ev)=>onDragStart(ev, f.id, 'folder');
    el.ondragover = (ev)=>{ ev.preventDefault(); el.classList.add('drop-target'); };
    el.ondragleave = ()=>{ el.classList.remove('drop-target'); };
    el.ondrop = (ev)=>{ el.classList.remove('drop-target'); onFolderDrop(ev); if(dragType==='folder') { reorderFolder(dragId, f.id); dragId=null; render(); } };
    const children = document.createElement('div'); children.className = 'folder-children'; children.id = 'children-'+f.id; children.style.display = f._open? 'block':'none';
    Object.values(db.files).forEach(file=>{ if(file.folder===f.id){ const fi = document.createElement('div'); fi.className='file-item draggable'; fi.dataset.id = file.id;
      // 2. 변경: 현재 열린 파일이면 active-file 클래스 추가
      if(file.id === currentFileId) { fi.classList.add('active-file'); }
      fi.innerHTML = `<div class="meta"><div class="name">${escapeHtml(file.name)}</div><div class="sub">${new Date(file.updated).toLocaleString()}</div></div><div class="actions"><input type="checkbox" onchange="toggleSelect(event,'${file.id}')" ${selectedFiles.has(file.id)?'checked':''}></div>`; fi.onclick = ()=>openFile(file.id); fi.draggable=true; fi.ondragstart=(ev)=>onDragStart(ev,file.id,'file'); fi.ondragover=(ev)=>{ev.preventDefault(); fi.classList.add('drop-target')}; fi.ondragleave=()=>fi.classList.remove('drop-target'); fi.ondrop=(ev)=>{fi.classList.remove('drop-target'); if(dragType==='file'){ reorderFile(dragId,file.id); dragId=null; render(); }}; children.appendChild(fi); }});
    cont.appendChild(el); cont.appendChild(children);
  })
}

function renderFiles(){
  const cont = document.getElementById('files'); cont.innerHTML='';
  const q = document.getElementById('search').value.toLowerCase();
  const filter = document.getElementById('filter').value;
  db.order.forEach(id=>{
    const f = db.files[id];
    if(!f || f.folder) return;
    if(filter==='star' && !f.star) return;
    if(q){if(!(f.name.toLowerCase().includes(q) || stripTags(f.content).toLowerCase().includes(q))) return}
    const div = document.createElement('div'); div.className='file-item draggable'; div.dataset.id = f.id;
    // 2. 변경: 현재 열린 파일이면 active-file 클래스 추가
    if(f.id === currentFileId) { div.classList.add('active-file'); }
    div.innerHTML = `<div class="meta"><div class="name">${escapeHtml(f.name)}</div><div class="sub">${new Date(f.updated).toLocaleString()}</div></div>
      <div class="actions"><input type="checkbox" onchange="toggleSelect(event,'${f.id}')" ${selectedFiles.has(f.id)?'checked':''}></div>`;
    div.onclick = ()=>openFile(f.id);
    div.draggable = true;
    div.ondragstart = (ev)=>onDragStart(ev, f.id, 'file');
    div.ondragover = (ev)=>{ ev.preventDefault(); div.classList.add('drop-target'); };
    div.ondragleave = ()=>{ div.classList.remove('drop-target'); };
    div.ondrop = (ev)=>{ div.classList.remove('drop-target'); if(dragType==='file'){ reorderFile(dragId, f.id); dragId=null; render(); } };
    cont.appendChild(div);
  })
}


// --- helpers ---
function escapeHtml(s){return (s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c])}
function stripTags(html){return html.replace(/<[^>]+>/g,'')}

// --- file ops ---
function newFile(){
  const id=uid(); db.files[id]={id,name:'무제',content:'',folder:null,star:false,created:Date.now(),updated:Date.now()}; db.order.unshift(id); saveDB(); render(); openFile(id);
}
function newFolder(){
  const name = prompt('폴더 이름:'); if(!name) return; const id=uid('d'); db.folders[id]={id,name}; db.folderOrder = db.folderOrder || []; db.folderOrder.unshift(id); saveDB(); render();
}
function toggleFolder(id){ db.folders[id]._open = !db.folders[id]._open; saveDB(); render(); }
function openFolder(id){ db.folders[id]._open = !db.folders[id]._open; saveDB(); render(); }
function renameFolder(id){
  const name = prompt('새 폴더 이름:', db.folders[id].name); if(!name) return; db.folders[id].name=name; saveDB(); render();
}
function deleteFolder(id){
  if(!confirm('폴더와 그 안의 파일들을 삭제하시겠어요?')) return;
  Object.values(db.files).forEach(f=>{if(f.folder===id) delete db.files[f.id];}); delete db.folders[id]; db.folderOrder = (db.folderOrder||[]).filter(x=>x!==id); db.order = db.order.filter(x=>db.files[x]); saveDB(); render();
}
function openFile(id){
  currentFileId = id; const f = db.files[id]; document.getElementById('editor').innerHTML = f.content || '';
  document.getElementById('fileNameInput').value = f.name || '';
  // 2. 변경 & 5. 변경: 파일 열 때마다 렌더링 다시하고 통계 업데이트
  render();
  updateStats();
}
function renameCurrentFileFromInput(){
  if(!currentFileId) return; const newName = document.getElementById('fileNameInput').value.trim(); if(!newName) return alert('이름을 비울 수 없습니다'); db.files[currentFileId].name = newName; db.files[currentFileId].updated = Date.now(); saveDB(); render();
}
function saveCurrent(){
  if(!currentFileId) return alert('먼저 파일을 선택하세요');
  const content = document.getElementById('editor').innerHTML;
  const f = db.files[currentFileId]; f.content = content; f.updated = Date.now(); if(!f.name || f.name==='무제'){
    const t = stripTags(content).slice(0,30).trim(); if(t) f.name = t;
  }
  saveDB(); render();
  // 저장 후 피드백
  const saveBtn = document.getElementById('btnSave');
  saveBtn.textContent = '✅ 저장됨';
  setTimeout(() => { saveBtn.textContent = '💾 저장'; }, 1500);
}
function deleteFileById(id){
  if(!confirm('파일을 삭제할까요?')) return; delete db.files[id]; db.order = db.order.filter(x=>x!==id); if(currentFileId===id){ currentFileId=null; document.getElementById('editor').innerHTML=''; document.getElementById('fileNameInput').value=''; updateStats(); } saveDB(); render();
}
function deleteCurrentFile(){ if(!currentFileId) return alert('파일 선택'); deleteFileById(currentFileId); }
function toggleSelect(ev,id){ if(ev.target.checked) selectedFiles.add(id); else selectedFiles.delete(id); }
function toggleStar(id){ db.files[id].star = !db.files[id].star; saveDB(); render(); }
function downloadTxt(id){ const f=db.files[id]; const blob=new Blob([stripTags(f.content)],{type:'text/plain;charset=utf-8'}); saveAs(blob, (f.name||'untitled')+'.txt'); }
function downloadDocx(id){ const f = db.files[id]; const html = `<html><body>${f.content||''}</body></html>`; try{ const converted = window.htmlDocx.asBlob(html); saveAs(converted, (f.name||'document') + '.docx'); }catch(e){alert('DOCX 생성 실패: '+e.message)} }
function downloadPdf(id){ const f=db.files[id]; const { jsPDF } = window.jspdf; const doc = new jsPDF(); const text = stripTags(f.content); const lines = doc.splitTextToSize(text, 180); doc.text(lines,10,10); const blob = doc.output('blob'); saveAs(blob, (f.name||'doc') + '.pdf'); }
function downloadSelectedFormats(formats){ if(!currentFileId) return alert('파일을 선택하세요'); formats.forEach(fmt=>{ if(fmt==='txt') downloadTxt(currentFileId); if(fmt==='docx') downloadDocx(currentFileId); if(fmt==='pdf') downloadPdf(currentFileId); }); }

// --- import ---
const fileInput = document.getElementById('fileInput'); fileInput.addEventListener('change', async e=>{
  // ... (import logic is unchanged)
});
function arrayBufferToBase64(buffer){ let binary=''; const bytes = new Uint8Array(buffer); const len = bytes.byteLength; for(let i=0;i<len;i++){binary+=String.fromCharCode(bytes[i]);} return btoa(binary); }

// --- merge/delete selected ---
function mergeSelected(){ if(selectedFiles.size<2) return alert('두 개 이상의 파일을 선택하세요');
  const ids = Array.from(selectedFiles); let merged=''; let name='병합문서'; ids.forEach(id=>{const f=db.files[id]; merged += `<h3>${escapeHtml(f.name)}</h3>` + (f.content||'') + '<hr>';});
  const id = uid(); db.files[id]={id,name: name,content:merged,folder:null,star:false,created:Date.now(),updated:Date.now()}; db.order.unshift(id); saveDB(); render(); openFile(id); selectedFiles.clear();
}
function deleteSelected(){ if(selectedFiles.size===0) return alert('선택된 파일이 없습니다'); if(!confirm('선택된 파일을 삭제할까요?')) return; selectedFiles.forEach(id=>{delete db.files[id]; db.order = db.order.filter(x=>x!==id)}); saveDB(); render(); selectedFiles.clear(); }

// 5. 변경: 통계 업데이트 함수
function updateStats() {
    const editor = document.getElementById('editor');
    const text = editor.innerText || '';
    const html = editor.innerHTML || '';

    // 글자 수 (공백 포함)
    const charCount = text.length;
    document.getElementById('statChars').textContent = charCount.toLocaleString();

    // 글자 수 (공백 제외)
    const charCountNoSpace = text.replace(/\s/g, '').length;
    document.getElementById('statCharsNoSpace').textContent = charCountNoSpace.toLocaleString();

    // 단어 수
    const words = text.match(/\S+/g) || [];
    document.getElementById('statWords').textContent = words.length.toLocaleString();

    // 문단 수 (비어있지 않은 줄 기준)
    const paragraphs = text.split('\n').filter(line => line.trim() !== '').length;
    document.getElementById('statParagraphs').textContent = paragraphs.toLocaleString();
    
    // 용량
    const sizeInBytes = new Blob([html]).size;
    let size = '';
    if (sizeInBytes < 1024) {
        size = `${sizeInBytes} B`;
    } else if (sizeInBytes < 1024 * 1024) {
        size = `${(sizeInBytes / 1024).toFixed(1)} KB`;
    } else {
        size = `${(sizeInBytes / (1024 * 1024)).toFixed(2)} MB`;
    }
    document.getElementById('statSize').textContent = size;
}


// --- UI bindings ---
document.getElementById('btnNewFile').onclick = newFile;
document.getElementById('btnNewFolder').onclick = newFolder;
document.getElementById('search').addEventListener('input', render);
document.getElementById('filter').addEventListener('change', render);
// 3. 변경: 분리된 버튼에 이벤트 핸들러 할당
document.getElementById('btnSave').onclick = saveCurrent;
document.getElementById('btnExport').onclick = ()=>{ openSaveExportModal(); };
document.getElementById('btnMerge').onclick = mergeSelected;
document.getElementById('btnDeleteSelected').onclick = deleteSelected;
const btnActions = document.getElementById('btnActions'); btnActions.addEventListener('click', ()=>{ openActionsMenu(); });
const autoSaveCb = document.getElementById('autoSave'); autoSaveCb.addEventListener('change', ()=>{ if(autoSaveCb.checked) startAutoSave(); else stopAutoSave();}); let autoSaveTimer=null;
function startAutoSave(){ if(autoSaveTimer) clearInterval(autoSaveTimer); autoSaveTimer = setInterval(()=>{ if(currentFileId) saveCurrent(); }, 3000);} function stopAutoSave(){ if(autoSaveTimer) clearInterval(autoSaveTimer); autoSaveTimer=null}

// keyboard shortcuts
document.addEventListener('keydown', e=>{
  if((e.ctrlKey||e.metaKey) && e.key==='s'){ e.preventDefault(); saveCurrent(); }
  if((e.ctrlKey||e.metaKey) && e.key==='b'){ e.preventDefault(); doCmd('bold'); }
});

// 5. 변경: 편집기 입력 시 통계 업데이트
document.getElementById('editor').addEventListener('input', ()=>{
    if(currentFileId) { db.files[currentFileId].updated=Date.now(); }
    updateStats();
});

const fileNameInput = document.getElementById('fileNameInput'); fileNameInput.addEventListener('change', renameCurrentFileFromInput);

// 1. 변경: 사이드바 토글 로직 수정
const appRoot = document.getElementById('appRoot');
const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
const expandHandle = document.getElementById('expandHandle');
function toggleSidebar() {
    const isHidden = appRoot.classList.toggle('sidebar-hidden');
    toggleSidebarBtn.textContent = isHidden ? '➡' : '⬅';
    toggleSidebarBtn.title = isHidden ? '사이드바 펼치기' : '사이드바 숨기기';
}
toggleSidebarBtn.addEventListener('click', toggleSidebar);
expandHandle.addEventListener('click', toggleSidebar);


const btnSettings = document.getElementById('btnSettings'); btnSettings.addEventListener('click', ()=>{ openSettingsModal(); });

function doCmd(cmd, val=null){ document.execCommand(cmd, false, val); }
let dark=false; function applyDark(d){ dark = !!d; document.documentElement.classList.toggle('dark', dark); document.body.classList.toggle('dark', dark); localStorage.setItem('wn_dark', dark? '1':'0'); }
if(localStorage.getItem('wn_dark')==='1') applyDark(true);

// ... (modal functions are mostly unchanged) ...

// --- initial load ---
if(db.order.length) openFile(db.order[0]);
render();
updateStats();

// expose functions
window.toggleFolder = toggleFolder; window.openFolder = openFolder; window.renameFolder = renameFolder; window.deleteFolder = deleteFolder;
// ... other exposed functions

// --- UI modal implementations ---
function openModal(contentHtml){ const root = document.getElementById('modalRoot'); root.innerHTML = `<div class="modal-backdrop"> <div class="modal">${contentHtml}</div> </div>`; root.style.display='block'; root.querySelector('.modal-backdrop').addEventListener('click', (e)=>{ if(e.target.classList.contains('modal-backdrop')) closeModal(); }); }
function closeModal(){ const root = document.getElementById('modalRoot'); root.innerHTML=''; root.style.display='none'; }
function openSaveExportModal(){ if(!currentFileId) return alert('파일을 선택하세요'); const html = `...`; openModal(html); /* ... (modal logic unchanged) ... */ }
function openActionsMenu(){ if(!currentFileId) return alert('파일을 선택하세요'); const html = `...`; openModal(html); /* ... (modal logic unchanged) ... */ }
function openSettingsModal(){ const html = `...`; openModal(html); /* ... (modal logic unchanged) ... */ }

</script>
</body>
</html>
