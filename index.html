<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Static Web Notepad</title>
  <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.4.1/dist/html-docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.3/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

  <style>
    :root{--bg:#f7f8fb;--card:#fff;--muted:#666;--sidebar:#f8fafc;--accent:#0b66ff;--active-bg:#e9ecef}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:#111}
    .app{display:grid;grid-template-columns:300px 1fr;grid-template-rows:1fr auto;height:100vh;transition:grid-template-columns .25s ease}
    .app.sidebar-hidden{grid-template-columns:0 1fr}
    nav{background:var(--sidebar);border-right:1px solid #e6e9ef;padding:12px;overflow:auto;transition:transform .25s ease,width .25s}
    .app.sidebar-hidden nav{transform:translateX(-100%);padding:12px 0;border-right:none}
    header{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    header h2{margin:0;font-size:16px}
    .controls{display:flex;gap:6px;flex-wrap:wrap}
    button,select,input[type=text]{background:#fff;border:1px solid #ddd;padding:6px 8px;border-radius:6px;cursor:pointer}
    button.small{padding:6px}
    .list{margin-top:8px}
    .section-title{font-size:12px;color:var(--muted);margin:10px 0 6px}
    .folder, .file-item{padding:8px;border-radius:6px;margin-bottom:6px;display:flex;align-items:center;justify-content:space-between}
    .folder{background:linear-gradient(90deg,#fdfdfd,#fbfcff);border:1px solid #eee}
    .file-item{background:#fff;border:1px solid #f0f3f7}
    .file-item.draggable{cursor:grab}
    .file-item .meta{flex:1;overflow:hidden;display: flex;flex-direction: column;align-items: flex-start;gap: 2px;}
    .file-item .meta .name{font-weight:600;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;display: flex;align-items: center;gap: 4px;width: 100%;}
    .file-item .meta .sub{font-size:11px;color:var(--muted);padding-left: 2px;}
    .file-item .actions{display:flex;gap:6px;margin-left:8px}
    .folder.active-file, .file-item.active-file { background-color: var(--active-bg); }
    main{display:flex;flex-direction:column;gap:8px;padding:12px;overflow:hidden}
    .toolbar{display:flex;gap:6px;align-items:center}
    .toolbar .group{display:flex;gap:6px;align-items:center;background:var(--card);padding:6px;border-radius:8px;border:1px solid #e9edf3}
    #editor{flex:1;background:var(--card);border:1px solid #e6e9ef;padding:16px;border-radius:8px;overflow:auto}
    #editor[contenteditable="true"]:focus{outline:3px solid rgba(100,150,250,0.12)}
    .top-right-actions{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn-action{padding:6px 8px;border-radius:6px}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:200}
    .modal{background:var(--card);padding:16px;border-radius:8px;width:320px;box-shadow:0 6px 32px rgba(0,0,0,0.15)}
    #statsFooter{grid-column: 2 / 3; background:transparent;padding:6px 12px;border-top:1px solid #e9edf3;display:flex;gap:16px;align-items:center;font-size:12px;color:var(--muted); flex-wrap: wrap; }
    #statsFooter span { font-weight: 500; color: #444; }
    body.dark #statsFooter { border-color: #4a4a4a; color: var(--muted); }
    body.dark #statsFooter span { color: #ddd; }
    .github-icon{width:20px;height:20px;vertical-align:middle}
    .drop-target{outline:2px dashed var(--accent)}
    .folder-children{margin-left:12px;margin-top:6px}
    :root.dark{--bg:#2b2b2b;--card:#393939;--muted:#bfc4c8;--sidebar:#333437;--accent:#9fb8ff;--active-bg:#4a4a4a}
    body.dark{background:var(--bg);color:#efefef}
    body.dark nav{background:var(--sidebar);border-color:#4a4a4a}
    body.dark .file-item, body.dark .folder{background:var(--card);border-color:#4a4a4a}
    body.dark button{background:#5a5a5a;color:#eee;border-color:#666}
    #expandHandle{position:fixed;left:8px;top:16px;width:36px;height:36px;border-radius:6px;background:var(--card);border:1px solid #ddd;display:none;align-items:center;justify-content:center;z-index:300;cursor:pointer}
    .app.sidebar-hidden #expandHandle{display:flex}
    #btnBookmark.bookmarked { background-color: #ffc107; color: #000; border-color: #f5b300;}
    @media (max-width:800px){.app{grid-template-columns:1fr;grid-template-rows:auto 1fr auto}nav{order:2;height:220px;overflow:auto}.editor-wrap{order:1} #statsFooter{grid-column: 1 / -1;}}
  </style>
</head>
<body id="bodyRoot">
  <div class="app" id="appRoot">
    <nav id="sidebar">
      <header>
        <h2>ë©”ëª¨ v1.0.7</h2>
        <div style="margin-left:auto;display:flex;gap:6px;align-items:center">
          <button class="small" id="toggleSidebarBtn" title="ì‚¬ì´ë“œë°” ìˆ¨ê¸°ê¸°">â¬…</button>
          <button class="small" id="btnNewFile">+ íŒŒì¼</button>
          <button class="small" id="btnNewFolder">+ í´ë”</button>
        </div>
      </header>

      <div class="controls">
        <input id="search" type="text" placeholder="ê²€ìƒ‰ (íŒŒì¼ëª…/ë‚´ìš©)" style="flex:1">
        <select id="filter"><option value="all">ì „ì²´</option><option value="star">ë¶ë§ˆí¬</option></select>
      </div>

      <div class="list">
        <div class="section-title">í´ë”</div>
        <div id="folders" ondragover="allowDrop(event)" ondrop="onFolderContainerDrop(event)" ondragleave="onContainerDragLeave(event)"></div>
        <div class="section-title">íŒŒì¼</div>
        <div id="files" ondragover="allowDrop(event)" ondrop="onFileContainerDrop(event)" ondragleave="onContainerDragLeave(event)"></div>
      </div>

      <div style="margin-top:12px">
        <div class="section-title">ì„í¬íŠ¸</div>
        <input id="fileInput" type="file" multiple accept=".txt,.md,.html,.docx,.pdf" />
        <div style="margin-top:6px;font-size:12px;color:var(--muted)">ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ ê°€ëŠ¥ â€¢ .txt/.docx/.pdf ì§€ì›</div>
        <div class="section-title" style="margin-top:12px">ë³‘í•© / ê´€ë¦¬</div>
        <button id="btnMerge">ì„ íƒ íŒŒì¼ ë³‘í•©</button>
        <button id="btnDeleteSelected">ì„ íƒ ì‚­ì œ</button>
      </div>
    </nav>

    <main class="editor-wrap">
      <div class="toolbar">
        <div class="group">
          <button onclick="doCmd('bold')"><b>B</b></button>
          <button onclick="doCmd('italic')"><i>I</i></button>
          <button onclick="doCmd('underline')"><u>U</u></button>
          <button onclick="doCmd('strikeThrough')">S</button>
          <input type="color" id="colorPick" title="ìƒ‰ìƒ" onchange="doCmd('foreColor', this.value)">
          <select id="fontSize" onchange="doCmd('fontSize', this.value)"><option value="3">ê¸°ë³¸</option><option value="4">í¬ê²Œ</option><option value="5">ë” í¬ê²Œ</option></select>
        </div>
        <div class="group">
            <button id="btnSave" class="btn-action">ğŸ’¾ ì €ì¥</button>
            <button id="btnExport" class="btn-action">ë‚´ë³´ë‚´ê¸°</button>
            <label style="display:inline-flex;align-items:center;gap:6px;font-size:13px"><input type="checkbox" id="autoSave"> ìë™ì €ì¥</label>
        </div>
        <div class="top-right-actions">
          <input id="fileNameInput" type="text" placeholder="íŒŒì¼ ì´ë¦„" style="min-width:200px;padding:6px;border-radius:6px;border:1px solid #ddd;">
          <button id="btnBookmark" class="btn-action">â­ ë¶ë§ˆí¬</button>
          <button id="btnDeleteFile" class="btn-action">ğŸ—‘ï¸ ì‚­ì œ</button>
          <button id="btnSettings">âš™ í™˜ê²½ì„¤ì •</button>
        </div>
      </div>
      <div id="editor" contenteditable="true" spellcheck="false"></div>
    </main>
    <div id="expandHandle" title="ì‚¬ì´ë“œë°” í¼ì¹˜ê¸°">â¡</div>
    <footer id="statsFooter">
        ê¸€ì: <span id="statChars">0</span>
        ê³µë°±ì œì™¸: <span id="statCharsNoSpace">0</span>
        ë‹¨ì–´: <span id="statWords">0</span>
        ë¬¸ë‹¨: <span id="statParagraphs">0</span>
        ìš©ëŸ‰: <span id="statSize">0 B</span>
    </footer>
  </div>

  <div id="modalRoot" style="display:none"></div>

<script>
const DB_KEY = 'web_notepad_v1';
let db = {folders: {}, files: {}, order: [], folderOrder: []};
let selectedFiles = new Set();
let currentFileId = null;

function loadDB(){
  const raw = localStorage.getItem(DB_KEY);
  if(raw) try{db = JSON.parse(raw)}catch(e){console.error(e)}
  if(!db.files || !db.order || !db.folderOrder) db = {folders: {}, files: {}, order: [], folderOrder: []};
}
function saveDB(){ localStorage.setItem(DB_KEY, JSON.stringify(db)); }
function uid(prefix='f'){return prefix+Date.now().toString(36)+Math.random().toString(36).slice(2,8)}
loadDB();
if(Object.keys(db.files).length===0){
  const id = uid(); db.files[id] = {id,name:'ìƒˆ ë¬¸ì„œ',content:'',folder:null,star:false,created:Date.now(),updated:Date.now()}; db.order.push(id); saveDB();}
let dragId = null, dragType = null;
function allowDrop(e){ e.preventDefault(); e.currentTarget.classList.add('drop-target'); }
function onContainerDragLeave(e) { e.currentTarget.classList.remove('drop-target'); }
function onDragStart(ev, id, type){ dragId = id; dragType = type; ev.dataTransfer.setData('text/plain', id); ev.dataTransfer.effectAllowed = 'move'; }
function onDrop(ev, targetId) {
    ev.preventDefault();
    ev.stopPropagation();
    const targetElement = ev.currentTarget;
    targetElement.classList.remove('drop-target');
    if (dragType === 'file' && db.files[dragId].folder) {
    } else if (dragType === 'file') {
        reorderFile(dragId, targetId);
    } else if (dragType === 'folder') {
        reorderFolder(dragId, targetId);
    }
    dragId = null;
    dragType = null;
    render();
}
function onFileContainerDrop(ev) {
    ev.preventDefault();
    ev.currentTarget.classList.remove('drop-target');
    if (dragType === 'file' && !db.files[dragId].folder) {
        reorderFile(dragId, null);
        dragId = null;
        dragType = null;
        render();
    }
}
function onFolderContainerDrop(ev) {
    ev.preventDefault();
    ev.currentTarget.classList.remove('drop-target');
    if (dragType === 'folder') {
        reorderFolder(dragId, null);
        dragId = null;
        dragType = null;
        render();
    }
}
function onFolderDrop(ev, folderId){ 
    ev.preventDefault();
    ev.stopPropagation();
    ev.currentTarget.classList.remove('drop-target');
    if(dragType==='file'){
        db.files[dragId].folder = folderId;
        db.files[dragId].updated = Date.now();
        db.order = db.order.filter(id => id !== dragId);
        saveDB();
        render();
    }
    dragId = null;
    dragType = null;
}
function reorderFile(dragIdLocal, targetId){
  const idx = db.order.indexOf(dragIdLocal); if(idx>-1) db.order.splice(idx,1);
  if(targetId){ const ti = db.order.indexOf(targetId); db.order.splice(ti,0,dragIdLocal); }
  else { db.order.push(dragIdLocal); }
  saveDB();
}
function reorderFolder(dragIdLocal, targetId){
  const arr = db.folderOrder; const idx = arr.indexOf(dragIdLocal); if(idx>-1) arr.splice(idx,1);
  if(targetId){ const ti = arr.indexOf(targetId); arr.splice(ti,0,dragIdLocal); }
  else { arr.push(dragIdLocal); }
  db.folderOrder = arr;
  saveDB();
}

function render(){ renderFolders(); renderFiles(); updateBookmarkButtonState(); }

function renderFileItem(file) {
    const starIcon = file.star ? 'â­' : '';
    return `<div class="meta">
                <div class="name">${starIcon} ${escapeHtml(file.name)}</div>
                <div class="sub">${new Date(file.updated).toLocaleString('ko-KR', {dateStyle: 'short', timeStyle: 'short'})}</div>
            </div>
            <div class="actions">
                <input type="checkbox" onchange="toggleSelect(event,'${file.id}')" ${selectedFiles.has(file.id)?'checked':''}>
            </div>`;
}

// ### 1. & 2. ì˜¤ë¥˜ ìˆ˜ì •: ì´ í•¨ìˆ˜ ë‚´ë¶€ì˜ ë¡œì§ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ###
function renderFolders(){
  const cont = document.getElementById('folders');
  cont.innerHTML='';
  const order = db.folderOrder || [];
  const currentFile = db.files[currentFileId];

  order.forEach(fid=>{
    const f = db.folders[fid];
    if(!f) return;

    // í´ë” ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
    const el = document.createElement('div');
    el.className='folder';
    el.draggable = true;
    el.dataset.id = f.id;
    if(currentFile && currentFile.folder === f.id) { el.classList.add('active-file'); }
    el.innerHTML = `<div style="flex:1;display:flex;align-items:center;gap:8px"><button onclick="toggleFolder('${f.id}')">â–¸</button><div style=\"flex:1;cursor:pointer\" onclick=\"openFolder('${f.id}')\">ğŸ“ ${escapeHtml(f.name)}</div></div><div style="display:flex;gap:6px"><button onclick="renameFolder('${f.id}')">âœï¸</button><button onclick="deleteFolder('${f.id}')">ğŸ—‘ï¸</button></div>`;
    el.ondragstart = (ev)=>onDragStart(ev, f.id, 'folder');
    el.ondragover = allowDrop;
    el.ondragleave = (ev) => ev.currentTarget.classList.remove('drop-target');
    el.ondrop = (ev) => {
        if (dragType === 'file') onFolderDrop(ev, f.id);
        else onDrop(ev, f.id);
    };

    // í´ë” ë‚´ íŒŒì¼ë“¤ì„ ë‹´ì„ ì»¨í…Œì´ë„ˆ ìƒì„±
    const children = document.createElement('div');
    children.className = 'folder-children';
    children.id = 'children-'+f.id;
    children.style.display = f._open? 'block':'none';

    // í´ë”ì— ì†í•œ íŒŒì¼ë“¤ ì°¾ì•„ì„œ children ì»¨í…Œì´ë„ˆì— ì¶”ê°€
    Object.values(db.files).forEach(file => {
        if(file.folder === f.id) {
            const fi = document.createElement('div');
            fi.className='file-item draggable';
            fi.dataset.id = file.id;
            if(file.id === currentFileId) { fi.classList.add('active-file'); }
            fi.innerHTML = renderFileItem(file);
            fi.onclick = ()=>openFile(file.id);
            fi.draggable=true;
            fi.ondragstart=(ev)=>onDragStart(ev,file.id,'file');
            // íŒŒì¼ ì—˜ë¦¬ë¨¼íŠ¸ëŠ” childrenì— ì¶”ê°€
            children.appendChild(fi);
        }
    });

    // ìµœì¢…ì ìœ¼ë¡œ í´ë”ì™€ ìì‹ ì»¨í…Œì´ë„ˆë¥¼ DOMì— ì¶”ê°€ (í•œ ë²ˆë§Œ!)
    cont.appendChild(el);
    cont.appendChild(children);
  });
}

function renderFiles(){
  const cont = document.getElementById('files');
  cont.innerHTML='';
  const q = document.getElementById('search').value.toLowerCase();
  const filter = document.getElementById('filter').value;
  (db.order || []).forEach(id=>{
    const f = db.files[id];
    if(!f || f.folder) return;
    if(filter==='star' && !f.star) return;
    if(q && !(f.name.toLowerCase().includes(q) || stripTags(f.content).toLowerCase().includes(q))) return
    const div = document.createElement('div');
    div.className='file-item draggable';
    div.dataset.id = f.id;
    if(f.id === currentFileId) { div.classList.add('active-file'); }
    div.innerHTML = renderFileItem(f); // f -> file ì˜¤íƒ€ ìˆ˜ì •
    div.onclick = ()=>openFile(f.id);
    div.draggable = true;
    div.ondragstart = (ev)=>onDragStart(ev, f.id, 'file');
    div.ondragover = allowDrop;
    div.ondragleave = (ev) => ev.currentTarget.classList.remove('drop-target');
    div.ondrop = (ev) => onDrop(ev, f.id);
    cont.appendChild(div);
  })
}

function escapeHtml(s){return (s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c])}
function stripTags(html){return html.replace(/<[^>]+>/g,'')}
function newFile(){ const id=uid(); db.files[id]={id,name:'ë¬´ì œ',content:'',folder:null,star:false,created:Date.now(),updated:Date.now()}; db.order.push(id); saveDB(); render(); openFile(id); }
function newFolder(){ const name = prompt('í´ë” ì´ë¦„:'); if(!name) return; const id=uid('d'); db.folders[id]={id,name}; db.folderOrder.push(id); saveDB(); render(); }
function toggleFolder(id){ db.folders[id]._open = !db.folders[id]._open; saveDB(); render(); }
function openFolder(id){ db.folders[id]._open = !db.folders[id]._open; saveDB(); render(); }
function renameFolder(id){ const name = prompt('ìƒˆ í´ë” ì´ë¦„:', db.folders[id].name); if(!name) return; db.folders[id].name=name; saveDB(); render(); }
function deleteFolder(id){ if(!confirm('í´ë”ì™€ ê·¸ ì•ˆì˜ íŒŒì¼ë“¤ì„ ì‚­ì œí•˜ì‹œê² ì–´ìš”?')) return; Object.values(db.files).forEach(f=>{if(f.folder===id) delete db.files[f.id];}); delete db.folders[id]; db.folderOrder = (db.folderOrder||[]).filter(x=>x!==id); db.order = db.order.filter(x=>db.files[x]); saveDB(); render(); }
function openFile(id){ currentFileId = id; const f = db.files[id]; document.getElementById('editor').innerHTML = f.content || ''; document.getElementById('fileNameInput').value = f.name || ''; render(); updateStats(); }
function renameCurrentFileFromInput(){ if(!currentFileId) return; const newName = document.getElementById('fileNameInput').value.trim(); if(!newName) return alert('ì´ë¦„ì„ ë¹„ìš¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); db.files[currentFileId].name = newName; db.files[currentFileId].updated = Date.now(); saveDB(); render(); }
function saveCurrent(){ if(!currentFileId) return alert('ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”'); const content = document.getElementById('editor').innerHTML; const f = db.files[currentFileId]; f.content = content; f.updated = Date.now(); if(!f.name || f.name==='ë¬´ì œ'){ const t = stripTags(content).slice(0,30).trim(); if(t) f.name = t; } saveDB(); render(); const saveBtn = document.getElementById('btnSave'); saveBtn.textContent = 'âœ… ì €ì¥ë¨'; setTimeout(() => { saveBtn.textContent = 'ğŸ’¾ ì €ì¥'; }, 1500); }
function deleteFileById(id){ if(!confirm('íŒŒì¼ì„ ì‚­ì œí• ê¹Œìš”?')) return; delete db.files[id]; db.order = db.order.filter(x=>x!==id); if(currentFileId===id){ currentFileId=null; document.getElementById('editor').innerHTML=''; document.getElementById('fileNameInput').value=''; updateStats(); } saveDB(); render(); }
function deleteCurrentFile(){ if(!currentFileId) return alert('íŒŒì¼ ì„ íƒ'); deleteFileById(currentFileId); }
function toggleSelect(ev,id){ if(ev.target.checked) selectedFiles.add(id); else selectedFiles.delete(id); }
function downloadTxt(id){ const f=db.files[id]; const blob=new Blob([stripTags(f.content)],{type:'text/plain;charset=utf-8'}); saveAs(blob, (f.name||'untitled')+'.txt'); }
function downloadDocx(id){ const f = db.files[id]; const html = `<html><body>${f.content||''}</body></html>`; try{ const converted = window.htmlDocx.asBlob(html); saveAs(converted, (f.name||'document') + '.docx'); }catch(e){alert('DOCX ìƒì„± ì‹¤íŒ¨: '+e.message)} }
function downloadPdf(id){ const f=db.files[id]; const { jsPDF } = window.jspdf; const doc = new jsPDF(); const text = stripTags(f.content); const lines = doc.splitTextToSize(text, 180); doc.text(lines,10,10); const blob = doc.output('blob'); saveAs(blob, (f.name||'doc') + '.pdf'); }
function downloadSelectedFormats(formats){ if(!currentFileId) return alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”'); formats.forEach(fmt=>{ if(fmt==='txt') downloadTxt(currentFileId); if(fmt==='docx') downloadDocx(currentFileId); if(fmt==='pdf') downloadPdf(currentFileId); }); }
const fileInput = document.getElementById('fileInput'); fileInput.addEventListener('change', async e=>{ /* ... (unchanged) ... */ });
function arrayBufferToBase64(buffer){ let binary=''; const bytes = new Uint8Array(buffer); const len = bytes.byteLength; for(let i=0;i<len;i++){binary+=String.fromCharCode(bytes[i]);} return btoa(binary); }
function mergeSelected(){ if(selectedFiles.size<2) return alert('ë‘ ê°œ ì´ìƒì˜ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”'); const ids = Array.from(selectedFiles); let merged=''; let name='ë³‘í•©ë¬¸ì„œ'; ids.forEach(id=>{const f=db.files[id]; merged += `<h3>${escapeHtml(f.name)}</h3>` + (f.content||'') + '<hr>';}); const id = uid(); db.files[id]={id,name: name,content:merged,folder:null,star:false,created:Date.now(),updated:Date.now()}; db.order.push(id); saveDB(); render(); openFile(id); selectedFiles.clear(); }
function deleteSelected(){ if(selectedFiles.size===0) return alert('ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤'); if(!confirm('ì„ íƒëœ íŒŒì¼ì„ ì‚­ì œí• ê¹Œìš”?')) return; selectedFiles.forEach(id=>{delete db.files[id]; db.order = db.order.filter(x=>x!==id)}); saveDB(); render(); selectedFiles.clear(); }
function updateStats() { const editor = document.getElementById('editor'); const text = editor.innerText || ''; const html = editor.innerHTML || ''; const charCount = text.length; document.getElementById('statChars').textContent = charCount.toLocaleString(); const charCountNoSpace = text.replace(/\s/g, '').length; document.getElementById('statCharsNoSpace').textContent = charCountNoSpace.toLocaleString(); const words = text.match(/\S+/g) || []; document.getElementById('statWords').textContent = words.length.toLocaleString(); const paragraphs = text.split('\n').filter(line => line.trim() !== '').length; document.getElementById('statParagraphs').textContent = paragraphs.toLocaleString(); const sizeInBytes = new Blob([html]).size; let size = `${sizeInBytes} B`; if (sizeInBytes >= 1024 * 1024) { size = `${(sizeInBytes / (1024 * 1024)).toFixed(2)} MB`; } else if (sizeInBytes >= 1024) { size = `${(sizeInBytes / 1024).toFixed(1)} KB`; } document.getElementById('statSize').textContent = size; }
document.getElementById('btnNewFile').onclick = newFile; document.getElementById('btnNewFolder').onclick = newFolder; document.getElementById('search').addEventListener('input', render); document.getElementById('filter').addEventListener('change', render); document.getElementById('btnSave').onclick = saveCurrent; document.getElementById('btnExport').onclick = ()=>{ openSaveExportModal(); }; document.getElementById('btnMerge').onclick = mergeSelected; document.getElementById('btnDeleteSelected').onclick = deleteSelected; const autoSaveCb = document.getElementById('autoSave'); autoSaveCb.addEventListener('change', ()=>{ if(autoSaveCb.checked) startAutoSave(); else stopAutoSave();}); let autoSaveTimer=null;
function startAutoSave(){ if(autoSaveTimer) clearInterval(autoSaveTimer); autoSaveTimer = setInterval(()=>{ if(currentFileId) saveCurrent(); }, 3000);} function stopAutoSave(){ if(autoSaveTimer) clearInterval(autoSaveTimer); autoSaveTimer=null}
document.addEventListener('keydown', e=>{ if((e.ctrlKey||e.metaKey) && e.key==='s'){ e.preventDefault(); saveCurrent(); } if((e.ctrlKey||e.metaKey) && e.key==='b'){ e.preventDefault(); doCmd('bold'); }});
document.getElementById('editor').addEventListener('input', ()=>{ if(currentFileId) { db.files[currentFileId].updated=Date.now(); } updateStats(); });
const fileNameInput = document.getElementById('fileNameInput'); fileNameInput.addEventListener('change', renameCurrentFileFromInput);
const appRoot = document.getElementById('appRoot'); const toggleSidebarBtn = document.getElementById('toggleSidebarBtn'); const expandHandle = document.getElementById('expandHandle');
function toggleSidebar() { const isHidden = appRoot.classList.toggle('sidebar-hidden'); toggleSidebarBtn.textContent = isHidden ? 'â¡' : 'â¬…'; toggleSidebarBtn.title = isHidden ? 'ì‚¬ì´ë“œë°” í¼ì¹˜ê¸°' : 'ì‚¬ì´ë“œë°” ìˆ¨ê¸°ê¸°'; }
toggleSidebarBtn.addEventListener('click', toggleSidebar); expandHandle.addEventListener('click', toggleSidebar);
document.getElementById('btnSettings').addEventListener('click', ()=>{ openSettingsModal(); }); document.getElementById('btnDeleteFile').onclick = deleteCurrentFile; document.getElementById('btnBookmark').onclick = toggleBookmark;
function toggleBookmark() { if (!currentFileId) return alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”'); const file = db.files[currentFileId]; file.star = !file.star; file.updated = Date.now(); saveDB(); render(); }
function updateBookmarkButtonState() { const btn = document.getElementById('btnBookmark'); if (currentFileId && db.files[currentFileId] && db.files[currentFileId].star) { btn.classList.add('bookmarked'); } else { btn.classList.remove('bookmarked'); }}
function doCmd(cmd, val=null){ document.execCommand(cmd, false, val); }
let dark=false; function applyDark(d){ dark = !!d; document.documentElement.classList.toggle('dark', dark); document.body.classList.toggle('dark', dark); localStorage.setItem('wn_dark', dark? '1':'0'); }
if(localStorage.getItem('wn_dark')==='1') applyDark(true);
if(db.order && db.order.length) openFile(db.order[0]); else updateStats();
render();
function openModal(contentHtml){ const root = document.getElementById('modalRoot'); root.innerHTML = `<div class="modal-backdrop"> <div class="modal">${contentHtml}</div> </div>`; root.style.display='block'; root.querySelector('.modal-backdrop').addEventListener('click', (e)=>{ if(e.target.classList.contains('modal-backdrop')) closeModal(); }); }
function closeModal(){ const root = document.getElementById('modalRoot'); root.innerHTML=''; root.style.display='none'; }
function openSaveExportModal(){ if(!currentFileId) return alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”'); const html = `<h3>ë‚´ë³´ë‚´ê¸° í˜•ì‹ ì„ íƒ</h3> <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px"> <label><input type="checkbox" id="fmt_txt" checked> .txt</label> <label><input type="checkbox" id="fmt_docx"> .docx</label> <label><input type="checkbox" id="fmt_pdf"> .pdf</label> </div> <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"> <button id="exportCancel">ì·¨ì†Œ</button> <button id="exportOk">ë‚´ë³´ë‚´ê¸°</button> </div>`; openModal(html); document.getElementById('exportCancel').onclick = closeModal; document.getElementById('exportOk').onclick = ()=>{ const fmts = []; if(document.getElementById('fmt_txt').checked) fmts.push('txt'); if(document.getElementById('fmt_docx').checked) fmts.push('docx'); if(document.getElementById('fmt_pdf').checked) fmts.push('pdf'); if(fmts.length===0) return alert('í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”'); saveCurrent(); downloadSelectedFormats(fmts); closeModal(); }; }
function openSettingsModal(){ const html = `<h3>í™˜ê²½ì„¤ì •</h3> <div style="display:flex;flex-direction:column;gap:12px;margin-top:10px"> <label style="display:flex; align-items:center; justify-content: space-between;"> <span>ë‹¤í¬ëª¨ë“œ ì‚¬ìš©</span> <input type="checkbox" id="setting_dark"> </label> <hr style="border:none; border-top:1px solid #eee; margin: 4px 0;"> <div style="font-size: 13px;">ê°œë°œì: <a href="https://github.com/2000may24th" target="_blank" rel="noopener noreferrer">2000may24th (GitHub)</a></div> <button id="resetAll" style="background-color:#e53e3e; color:white; border:none;">ì „ì²´ ì‚­ì œ (ì´ˆê¸°í™”)</button> <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"> <button id="setting_close">ë‹«ê¸°</button> </div> </div>`; openModal(html); document.getElementById('setting_dark').checked = dark; document.getElementById('setting_dark').onchange = (e)=>{ applyDark(e.target.checked); }; document.getElementById('resetAll').onclick = resetAllData; document.getElementById('setting_close').onclick = closeModal; }
function resetAllData() { if (confirm('ì •ë§ë¡œ ëª¨ë“  íŒŒì¼ê³¼ í´ë”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) { db = {folders: {}, files: {}, order: [], folderOrder: []}; saveDB(); currentFileId = null; document.getElementById('editor').innerHTML = ''; document.getElementById('fileNameInput').value = ''; render(); updateStats(); closeModal(); alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.'); }}
</script>
</body>
</html>
