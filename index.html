<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Static Web Notepad</title>
  <!-- Libraries (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.4.1/dist/html-docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.3/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

  <style>
    :root {
      --bg: #f7f8fb;
      --card: #fff;
      --muted: #666;
      --active-bg: #ddd;
    }
    body.dark {
      --bg: #2b2b2b;
      --card: #3a3a3a;
      --muted: #aaa;
      --active-bg: #4a4a4a; /* ✅ 다크모드에서 선택된 파일/폴더를 옅은 회색으로 */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: Inter, system-ui, sans-serif; background: var(--bg); color: #111; }
    body.dark { color: #f0f0f0; }

    .app { display: grid; grid-template-columns: 300px 1fr; grid-template-rows: 1fr auto; height: 100vh; }

    nav { background: var(--card); border-right: 1px solid #e6e9ef; padding: 12px; overflow: auto; transition: width 0.3s; }
    nav.collapsed { width: 0; padding: 0; overflow: hidden; }

    header { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
    header h2 { margin: 0; font-size: 16px; }

    .controls { display: flex; gap: 6px; flex-wrap: wrap; }
    button, select, input[type=text] { background: #fff; border: 1px solid #ddd; padding: 6px 8px; border-radius: 6px; cursor: pointer; }
    body.dark button, body.dark select, body.dark input[type=text] { background: #555; border: 1px solid #777; color: #f0f0f0; }

    .list { margin-top: 8px; }
    .section-title { font-size: 12px; color: var(--muted); margin: 10px 0 6px; }

    .folder, .file-item { padding: 8px; border-radius: 6px; margin-bottom: 6px; cursor: pointer; }
    .folder { background: linear-gradient(90deg, #fdfdfd, #fbfcff); border: 1px solid #eee; }
    .file-item { background: #fff; border: 1px solid #f0f3f7; }
    body.dark .folder { background: #444; border-color: #666; }
    body.dark .file-item { background: #555; border-color: #777; }

    .folder.active-file, .file-item.active-file {
      background-color: var(--active-bg); /* ✅ 라이트/다크 구분 색상 적용 */
    }

    main { display: flex; flex-direction: column; gap: 8px; padding: 12px; transition: width 0.3s; }
    .toolbar { display: flex; gap: 6px; align-items: center; }
    .toolbar .group { display: flex; gap: 6px; align-items: center; background: var(--card); padding: 6px; border-radius: 8px; border: 1px solid #e9edf3; }

    #editor-container { flex: 1; display: flex; overflow: hidden; }
    #editor { flex: 1; background: var(--card); border: 1px solid #e6e9ef; padding: 16px; border-radius: 8px; overflow: auto; }
    #editor[contenteditable="true"]:focus { outline: 3px solid rgba(100,150,250,0.12); }
    #second-view { flex: 1; background: #fafafa; border-left: 1px solid #ccc; display: none; overflow: auto; padding: 16px; }

    footer { grid-column: 1 / -1; background: transparent; padding: 8px 12px; border-top: 1px solid #e9edf3; display: flex; justify-content: space-between; align-items: center; }
    a.github { font-weight: 600; text-decoration: none; color: #0b66ff; }

    .toggle-btn { position: absolute; top: 10px; left: 300px; background: #ccc; border: none; padding: 3px; cursor: pointer; z-index: 100; transition: left 0.3s; }
    nav.collapsed + .toggle-btn { left: 0; }
  </style>
</head>
<body>
  <div class="app">
    <nav id="sidebar">
      <header>
        <h2>Notepad v1.1.4.</h2>
        <div style="margin-left:auto;display:flex;gap:6px;align-items:center">
          <button class="small" id="btnNewFile">+ 파일</button>
          <button class="small" id="btnNewFolder">+ 폴더</button>
        </div>
      </header>

      <div class="controls">
        <input id="search" type="text" placeholder="검색 (파일명/내용)" style="flex:1">
        <select id="filter"><option value="all">전체</option><option value="star">북마크</option></select>
      </div>

      <div class="list" id="folderList">
        <!-- 폴더와 파일 목록이 동적으로 렌더링됨 -->
      </div>
    </nav>
    <button class="toggle-btn" onclick="toggleSidebar()">⬅</button>

    <main id="main">
      <div class="toolbar">
        <div class="group">
          <button onclick="saveFile()">저장</button>
          <button onclick="exportFile()">내보내기</button>
          <button onclick="showActions()">작업</button>
          <button onclick="toggleSecondView()">같이 보기</button>
          <button onclick="openSettings()">⚙️</button>
        </div>
      </div>
      <div id="editor-container">
        <div id="editor" contenteditable="true"></div>
        <div id="second-view"></div>
      </div>
    </main>
    <footer>
      <div style="font-size:12px;color:var(--muted)">로컬 저장 • 정적 페이지 (Github Pages)에서 동작</div>
    </footer>
  </div>

  <script>
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.querySelector('.toggle-btn');
    const main = document.getElementById('main');
    const editor = document.getElementById('editor');
    const secondView = document.getElementById('second-view');
    let currentFile = null;

    function toggleSidebar() {
      sidebar.classList.toggle('collapsed');
      if (sidebar.classList.contains('collapsed')) {
        toggleBtn.textContent = '➡';
        main.style.width = '100%';
      } else {
        toggleBtn.textContent = '⬅';
        main.style.width = '';
      }
    }

    function openFile(el, folder, file) {
      document.querySelectorAll('.file-item, .folder').forEach(e => e.classList.remove('active-file'));
      el.classList.add('active-file');
      el.parentElement.classList.add('active-file');
      currentFile = `${folder}/${file}`;
      editor.innerHTML = `<p>${file}의 내용</p>`;
    }

    function saveFile() {
      if (!currentFile) return alert('저장할 파일을 선택하세요');
      localStorage.setItem(currentFile, editor.innerHTML);
      alert('저장 완료');
    }

    function exportFile() {
      if (!currentFile) return alert('내보낼 파일을 선택하세요');
      const blob = new Blob([editor.innerText], {type: 'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = currentFile + '.txt';
      a.click();
    }

    function showActions() {
      alert('삭제 / 북마크 / 이동 기능 선택 창 (구현 필요)');
    }

    function toggleSecondView() {
      if (secondView.style.display === 'block') {
        secondView.style.display = 'none';
      } else {
        if (!currentFile) return alert('먼저 파일을 선택하세요');
        secondView.innerHTML = '<pre>' + editor.innerText + '</pre>';
        secondView.style.display = 'block';
      }
    }

    function openSettings() {
      alert('환경설정 모달 (다크모드 토글, 제작자 링크 포함)');
    }

    /* ✅ 드래그 앤 드롭 후 점선이 남는 오류 해결 */
    function cleanupDragState() {
      document.querySelectorAll('.drop-target').forEach(el => el.classList.remove('drop-target'));
    }
    document.addEventListener('dragend', cleanupDragState);
    document.addEventListener('drop', cleanupDragState);
  </script>
</body>
</html>
